{"version":3,"file":"easy-peasy.cjs.js","sources":["../src/lib.js","../src/easy-peasy.js","../src/context.js","../src/hooks.js","../src/provider.js"],"sourcesContent":["export const isStateObject = x =>\n  x !== null && typeof x === 'object' && !Array.isArray(x)\n","import {\n  applyMiddleware,\n  compose as reduxCompose,\n  createStore as reduxCreateStore,\n} from 'redux'\nimport memoizeOne from 'memoize-one'\nimport produce from 'immer'\nimport thunk from 'redux-thunk'\nimport { isStateObject } from './lib'\n\nconst effectSymbol = '__effect__'\nconst selectSymbol = '__select__'\nconst selectDependenciesSymbol = '__selectDependencies__'\nconst selectStateSymbol = '__selectState__'\nconst reducerSymbol = '__reducer__'\n\nconst get = (path, target) =>\n  path.reduce((acc, cur) => (isStateObject(acc) ? acc[cur] : undefined), target)\n\nconst set = (path, target, value) => {\n  path.reduce((acc, cur, idx) => {\n    if (idx + 1 === path.length) {\n      acc[cur] = value\n    } else {\n      acc[cur] = acc[cur] || {}\n    }\n    return acc[cur]\n  }, target)\n}\n\nconst tick = () => new Promise(resolve => setTimeout(resolve))\n\nconst startsWith = (target, search) =>\n  target.substr(0, search.length) === search\n\nexport const effect = fn => {\n  // eslint-disable-next-line no-param-reassign\n  fn[effectSymbol] = true\n  return fn\n}\n\nexport const select = (fn, dependencies) => {\n  const selector = memoizeOne(state => fn(state))\n  selector[selectSymbol] = true\n  selector[selectDependenciesSymbol] = dependencies\n  selector[selectStateSymbol] = {}\n  return selector\n}\n\nexport const reducer = fn => {\n  // eslint-disable-next-line no-param-reassign\n  fn[reducerSymbol] = true\n  return fn\n}\n\nexport const createStore = (model, options = {}) => {\n  const {\n    devTools = true,\n    middleware = [],\n    initialState = {},\n    injections,\n    compose,\n    reducerEnhancer = rootReducer => rootReducer,\n  } = options\n\n  const definition = {\n    ...model,\n    logFullState: state => {\n      // eslint-disable-next-line no-console\n      console.log(JSON.stringify(state, null, 2))\n    },\n  }\n\n  const references = {}\n  const defaultState = {}\n  const actionEffects = {}\n  const actionCreators = {}\n  const actionReducers = {}\n  const customReducers = []\n  const selectorReducers = []\n\n  const extract = (current, parentPath) =>\n    Object.keys(current).forEach(key => {\n      const value = current[key]\n      const path = [...parentPath, key]\n      if (typeof value === 'function') {\n        if (value[selectSymbol]) {\n          // skip\n          value[selectStateSymbol] = { parentPath, key, executed: false }\n          selectorReducers.push(value)\n        } else if (value[effectSymbol]) {\n          // Effect Action\n          const actionName = `@effect.${path.join('.')}`\n          const action = payload => {\n            if (devTools) {\n              references.dispatch({\n                type: actionName,\n                payload,\n              })\n            }\n            return value(\n              references.dispatch,\n              payload,\n              references.getState,\n              injections,\n              {\n                parent: parentPath,\n                path,\n              },\n            )\n          }\n          action.actionName = actionName\n          set(path, actionEffects, action)\n\n          // Effect Action Creator\n          set(path, actionCreators, payload =>\n            tick().then(() => references.dispatch(() => action(payload))),\n          )\n        } else if (value[reducerSymbol]) {\n          customReducers.push({ path, reducer: value })\n        } else {\n          // Reducer Action\n          const actionName = `@action.${path.join('.')}`\n          const action = (state, payload) =>\n            produce(state, draft =>\n              value(draft, payload, {\n                dispatch: references.dispatch,\n                dispatchLocal: get(path, references.dispatch),\n                getState: references.getState,\n              }),\n            )\n          action.actionName = actionName\n          set(path, actionReducers, action)\n\n          // Reducer Action Creator\n          set(path, actionCreators, payload =>\n            references.dispatch({\n              type: action.actionName,\n              payload,\n            }),\n          )\n        }\n      } else if (isStateObject(value) && Object.keys(value).length > 0) {\n        extract(value, path)\n      } else {\n        // State\n        const initialParentRef = get(parentPath, initialState)\n        if (initialParentRef && key in initialParentRef) {\n          set(path, defaultState, initialParentRef[key])\n        } else {\n          set(path, defaultState, value)\n        }\n      }\n    })\n\n  extract(definition, [])\n\n  const createReducers = () => {\n    const createActionsReducer = (current, path) => {\n      const actionReducersAtPath = Object.keys(current).reduce((acc, key) => {\n        const value = current[key]\n        if (typeof value === 'function' && !value[effectSymbol]) {\n          return [...acc, value]\n        }\n        return acc\n      }, [])\n      const stateAtPath = Object.keys(current).reduce(\n        (acc, key) => (isStateObject(current[key]) ? [...acc, key] : acc),\n        [],\n      )\n      const nestedReducers = stateAtPath.map(key => [\n        key,\n        createActionsReducer(current[key], [...path, key]),\n      ])\n      return (state = get(path, defaultState), action) => {\n        // short circuit effects as they are noop in reducers\n        if (startsWith(action.type, '@effect.')) {\n          return state\n        }\n        // short circuit actions if they aren't a match on current path\n        if (\n          path.length > 0 &&\n          !startsWith(action.type, `@action.${path.join('.')}`)\n        ) {\n          return state\n        }\n        const actionReducer = actionReducersAtPath.find(\n          x => x.actionName === action.type,\n        )\n        if (actionReducer) {\n          return actionReducer(state, action.payload)\n        }\n        for (let i = 0; i < nestedReducers.length; i += 1) {\n          const [key, red] = nestedReducers[i]\n          const newState = red(state[key], action)\n          if (state[key] !== newState) {\n            return {\n              ...state,\n              [key]: newState,\n            }\n          }\n        }\n        return state\n      }\n    }\n\n    const reducerForActions = createActionsReducer(actionReducers, [])\n\n    const reducerWithCustom =\n      customReducers.length > 0\n        ? (state, action) => {\n            const stateAfterActions = reducerForActions(state, action)\n            return produce(stateAfterActions, draft => {\n              customReducers.forEach(({ path: p, reducer: red }) => {\n                const current = get(p, draft)\n                set(p, draft, red(current, action))\n              })\n            })\n          }\n        : reducerForActions\n\n    const runSelectorReducer = (state, selector) => {\n      const { parentPath, key, executed } = selector[selectStateSymbol]\n      if (executed) {\n        return state\n      }\n      const dependencies = selector[selectDependenciesSymbol]\n\n      const stateAfterDependencies = dependencies\n        ? dependencies.reduce(runSelectorReducer, state)\n        : state\n\n      let newState = state\n\n      if (parentPath.length > 0) {\n        const target = get(parentPath, stateAfterDependencies)\n        if (target) {\n          const newValue = selector(target)\n          newState = produce(state, draft => {\n            const updateTarget = get(parentPath, draft)\n            updateTarget[key] = newValue\n          })\n        }\n      } else {\n        const newValue = selector(stateAfterDependencies)\n        newState = produce(state, draft => {\n          // eslint-disable-next-line no-param-reassign\n          draft[key] = newValue\n        })\n      }\n\n      // eslint-disable-next-line no-param-reassign\n      selector[selectStateSymbol].executed = true\n      return newState\n    }\n\n    const runSelectors = state =>\n      selectorReducers.reduce(runSelectorReducer, state)\n\n    let isInitial = true\n\n    return selectorReducers.length > 0\n      ? (state, action) => {\n          const stateAfterActions = reducerWithCustom(state, action)\n          if (state !== stateAfterActions || isInitial) {\n            const stateAfterSelectors = runSelectors(stateAfterActions)\n            isInitial = false\n            selectorReducers.forEach(selector => {\n              // eslint-disable-next-line no-param-reassign\n              selector[selectStateSymbol].executed = false\n            })\n            return stateAfterSelectors\n          }\n          return stateAfterActions\n        }\n      : reducerWithCustom\n  }\n\n  const reducers = createReducers()\n\n  const composeEnhancers =\n    compose ||\n    (devTools &&\n    typeof window !== 'undefined' &&\n    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n      ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n      : reduxCompose)\n\n  const store = reduxCreateStore(\n    reducerEnhancer(reducers),\n    defaultState,\n    composeEnhancers(applyMiddleware(thunk, ...middleware)),\n  )\n\n  // attach the action creators to dispatch\n  Object.keys(actionCreators).forEach(key => {\n    store.dispatch[key] = actionCreators[key]\n  })\n\n  references.dispatch = store.dispatch\n  references.getState = store.getState\n  references.getState.getState = store.getState\n\n  return store\n}\n","import { createContext } from 'react'\n\nconst StoreContext = createContext()\n\nexport default StoreContext\n","import { useState, useEffect, useContext, useRef } from 'react'\nimport shallowEqual from 'shallowequal'\nimport EasyPeasyContext from './context'\nimport { isStateObject } from './lib'\n\nexport function useStore(mapState, dependencies = []) {\n  const store = useContext(EasyPeasyContext)\n  const [state, setState] = useState(mapState(store.getState()))\n  // As our effect only fires on mount and unmount it won't have the state\n  // changes visible to it, therefore we use a mutable ref to track this.\n  const stateRef = useRef(state)\n  // Helps avoid firing of events when unsubscribed, i.e. unmounted\n  const isActive = useRef(true)\n  useEffect(() => {\n    const calculateState = () => {\n      const newState = mapState(store.getState())\n      isActive.current = true\n      if (\n        newState === stateRef.current ||\n        (isStateObject(newState) &&\n          isStateObject(stateRef.current) &&\n          shallowEqual(newState, stateRef.current))\n      ) {\n        // Do nothing\n        return\n      }\n      stateRef.current = newState\n      // The settimeout wrap fixes a strange issue where a setState would\n      // fire but the associated hook wouldn't receive it. It's almost as\n      // if the effect was handled in a synchronous manner in some part of\n      // the React reconciliation process that ended up with it not\n      // propagating\n      setTimeout(() => {\n        if (isActive.current) {\n          setState(newState)\n        }\n      })\n    }\n    calculateState()\n    const unsubscribe = store.subscribe(calculateState)\n    return () => {\n      unsubscribe()\n      isActive.current = false\n    }\n  }, dependencies)\n  return state\n}\nexport function useAction(mapActions) {\n  const store = useContext(EasyPeasyContext)\n  return mapActions(store.dispatch)\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport StoreContext from './context'\n\nconst StoreProvider = ({ children, store }) => (\n  <StoreContext.Provider value={store}>{children}</StoreContext.Provider>\n)\n\nStoreProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n  store: PropTypes.object.isRequired,\n}\n\nexport default StoreProvider\n"],"names":["isStateObject","x","Array","isArray","effectSymbol","selectSymbol","selectDependenciesSymbol","selectStateSymbol","reducerSymbol","get","path","target","reduce","acc","cur","undefined","set","value","idx","length","tick","Promise","resolve","setTimeout","startsWith","search","substr","effect","fn","select","dependencies","selector","memoizeOne","state","reducer","createStore","model","options","devTools","middleware","initialState","injections","compose","reducerEnhancer","rootReducer","definition","logFullState","console","log","JSON","stringify","references","defaultState","actionEffects","actionCreators","actionReducers","customReducers","selectorReducers","extract","current","parentPath","Object","keys","forEach","key","executed","push","actionName","join","action","payload","dispatch","type","getState","parent","then","produce","draft","dispatchLocal","initialParentRef","createReducers","createActionsReducer","actionReducersAtPath","stateAtPath","nestedReducers","map","actionReducer","find","i","red","newState","reducerForActions","reducerWithCustom","stateAfterActions","p","runSelectorReducer","stateAfterDependencies","newValue","updateTarget","runSelectors","isInitial","stateAfterSelectors","reducers","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","reduxCompose","store","reduxCreateStore","applyMiddleware","thunk","StoreContext","createContext","useStore","mapState","useContext","EasyPeasyContext","useState","setState","stateRef","useRef","isActive","useEffect","calculateState","shallowEqual","unsubscribe","subscribe","useAction","mapActions","StoreProvider","children","React"],"mappings":"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"}