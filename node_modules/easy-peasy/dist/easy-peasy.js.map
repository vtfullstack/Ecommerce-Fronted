{"version":3,"file":"easy-peasy.js","sources":["../src/lib.js","../src/easy-peasy.js","../node_modules/shallowequal/index.js","../src/context.js","../src/hooks.js","../src/provider.js"],"sourcesContent":["export const isStateObject = x =>\n  x !== null && typeof x === 'object' && !Array.isArray(x)\n","import {\n  applyMiddleware,\n  compose as reduxCompose,\n  createStore as reduxCreateStore,\n} from 'redux'\nimport memoizeOne from 'memoize-one'\nimport produce from 'immer'\nimport thunk from 'redux-thunk'\nimport { isStateObject } from './lib'\n\nconst effectSymbol = '__effect__'\nconst selectSymbol = '__select__'\nconst selectDependenciesSymbol = '__selectDependencies__'\nconst selectStateSymbol = '__selectState__'\nconst reducerSymbol = '__reducer__'\n\nconst get = (path, target) =>\n  path.reduce((acc, cur) => (isStateObject(acc) ? acc[cur] : undefined), target)\n\nconst set = (path, target, value) => {\n  path.reduce((acc, cur, idx) => {\n    if (idx + 1 === path.length) {\n      acc[cur] = value\n    } else {\n      acc[cur] = acc[cur] || {}\n    }\n    return acc[cur]\n  }, target)\n}\n\nconst tick = () => new Promise(resolve => setTimeout(resolve))\n\nconst startsWith = (target, search) =>\n  target.substr(0, search.length) === search\n\nexport const effect = fn => {\n  // eslint-disable-next-line no-param-reassign\n  fn[effectSymbol] = true\n  return fn\n}\n\nexport const select = (fn, dependencies) => {\n  const selector = memoizeOne(state => fn(state))\n  selector[selectSymbol] = true\n  selector[selectDependenciesSymbol] = dependencies\n  selector[selectStateSymbol] = {}\n  return selector\n}\n\nexport const reducer = fn => {\n  // eslint-disable-next-line no-param-reassign\n  fn[reducerSymbol] = true\n  return fn\n}\n\nexport const createStore = (model, options = {}) => {\n  const {\n    devTools = true,\n    middleware = [],\n    initialState = {},\n    injections,\n    compose,\n    reducerEnhancer = rootReducer => rootReducer,\n  } = options\n\n  const definition = {\n    ...model,\n    logFullState: state => {\n      // eslint-disable-next-line no-console\n      console.log(JSON.stringify(state, null, 2))\n    },\n  }\n\n  const references = {}\n  const defaultState = {}\n  const actionEffects = {}\n  const actionCreators = {}\n  const actionReducers = {}\n  const customReducers = []\n  const selectorReducers = []\n\n  const extract = (current, parentPath) =>\n    Object.keys(current).forEach(key => {\n      const value = current[key]\n      const path = [...parentPath, key]\n      if (typeof value === 'function') {\n        if (value[selectSymbol]) {\n          // skip\n          value[selectStateSymbol] = { parentPath, key, executed: false }\n          selectorReducers.push(value)\n        } else if (value[effectSymbol]) {\n          // Effect Action\n          const actionName = `@effect.${path.join('.')}`\n          const action = payload => {\n            if (devTools) {\n              references.dispatch({\n                type: actionName,\n                payload,\n              })\n            }\n            return value(\n              references.dispatch,\n              payload,\n              references.getState,\n              injections,\n              {\n                parent: parentPath,\n                path,\n              },\n            )\n          }\n          action.actionName = actionName\n          set(path, actionEffects, action)\n\n          // Effect Action Creator\n          set(path, actionCreators, payload =>\n            tick().then(() => references.dispatch(() => action(payload))),\n          )\n        } else if (value[reducerSymbol]) {\n          customReducers.push({ path, reducer: value })\n        } else {\n          // Reducer Action\n          const actionName = `@action.${path.join('.')}`\n          const action = (state, payload) =>\n            produce(state, draft =>\n              value(draft, payload, {\n                dispatch: references.dispatch,\n                dispatchLocal: get(path, references.dispatch),\n                getState: references.getState,\n              }),\n            )\n          action.actionName = actionName\n          set(path, actionReducers, action)\n\n          // Reducer Action Creator\n          set(path, actionCreators, payload =>\n            references.dispatch({\n              type: action.actionName,\n              payload,\n            }),\n          )\n        }\n      } else if (isStateObject(value) && Object.keys(value).length > 0) {\n        extract(value, path)\n      } else {\n        // State\n        const initialParentRef = get(parentPath, initialState)\n        if (initialParentRef && key in initialParentRef) {\n          set(path, defaultState, initialParentRef[key])\n        } else {\n          set(path, defaultState, value)\n        }\n      }\n    })\n\n  extract(definition, [])\n\n  const createReducers = () => {\n    const createActionsReducer = (current, path) => {\n      const actionReducersAtPath = Object.keys(current).reduce((acc, key) => {\n        const value = current[key]\n        if (typeof value === 'function' && !value[effectSymbol]) {\n          return [...acc, value]\n        }\n        return acc\n      }, [])\n      const stateAtPath = Object.keys(current).reduce(\n        (acc, key) => (isStateObject(current[key]) ? [...acc, key] : acc),\n        [],\n      )\n      const nestedReducers = stateAtPath.map(key => [\n        key,\n        createActionsReducer(current[key], [...path, key]),\n      ])\n      return (state = get(path, defaultState), action) => {\n        // short circuit effects as they are noop in reducers\n        if (startsWith(action.type, '@effect.')) {\n          return state\n        }\n        // short circuit actions if they aren't a match on current path\n        if (\n          path.length > 0 &&\n          !startsWith(action.type, `@action.${path.join('.')}`)\n        ) {\n          return state\n        }\n        const actionReducer = actionReducersAtPath.find(\n          x => x.actionName === action.type,\n        )\n        if (actionReducer) {\n          return actionReducer(state, action.payload)\n        }\n        for (let i = 0; i < nestedReducers.length; i += 1) {\n          const [key, red] = nestedReducers[i]\n          const newState = red(state[key], action)\n          if (state[key] !== newState) {\n            return {\n              ...state,\n              [key]: newState,\n            }\n          }\n        }\n        return state\n      }\n    }\n\n    const reducerForActions = createActionsReducer(actionReducers, [])\n\n    const reducerWithCustom =\n      customReducers.length > 0\n        ? (state, action) => {\n            const stateAfterActions = reducerForActions(state, action)\n            return produce(stateAfterActions, draft => {\n              customReducers.forEach(({ path: p, reducer: red }) => {\n                const current = get(p, draft)\n                set(p, draft, red(current, action))\n              })\n            })\n          }\n        : reducerForActions\n\n    const runSelectorReducer = (state, selector) => {\n      const { parentPath, key, executed } = selector[selectStateSymbol]\n      if (executed) {\n        return state\n      }\n      const dependencies = selector[selectDependenciesSymbol]\n\n      const stateAfterDependencies = dependencies\n        ? dependencies.reduce(runSelectorReducer, state)\n        : state\n\n      let newState = state\n\n      if (parentPath.length > 0) {\n        const target = get(parentPath, stateAfterDependencies)\n        if (target) {\n          const newValue = selector(target)\n          newState = produce(state, draft => {\n            const updateTarget = get(parentPath, draft)\n            updateTarget[key] = newValue\n          })\n        }\n      } else {\n        const newValue = selector(stateAfterDependencies)\n        newState = produce(state, draft => {\n          // eslint-disable-next-line no-param-reassign\n          draft[key] = newValue\n        })\n      }\n\n      // eslint-disable-next-line no-param-reassign\n      selector[selectStateSymbol].executed = true\n      return newState\n    }\n\n    const runSelectors = state =>\n      selectorReducers.reduce(runSelectorReducer, state)\n\n    let isInitial = true\n\n    return selectorReducers.length > 0\n      ? (state, action) => {\n          const stateAfterActions = reducerWithCustom(state, action)\n          if (state !== stateAfterActions || isInitial) {\n            const stateAfterSelectors = runSelectors(stateAfterActions)\n            isInitial = false\n            selectorReducers.forEach(selector => {\n              // eslint-disable-next-line no-param-reassign\n              selector[selectStateSymbol].executed = false\n            })\n            return stateAfterSelectors\n          }\n          return stateAfterActions\n        }\n      : reducerWithCustom\n  }\n\n  const reducers = createReducers()\n\n  const composeEnhancers =\n    compose ||\n    (devTools &&\n    typeof window !== 'undefined' &&\n    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n      ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__\n      : reduxCompose)\n\n  const store = reduxCreateStore(\n    reducerEnhancer(reducers),\n    defaultState,\n    composeEnhancers(applyMiddleware(thunk, ...middleware)),\n  )\n\n  // attach the action creators to dispatch\n  Object.keys(actionCreators).forEach(key => {\n    store.dispatch[key] = actionCreators[key]\n  })\n\n  references.dispatch = store.dispatch\n  references.getState = store.getState\n  references.getState.getState = store.getState\n\n  return store\n}\n","//\n\nmodule.exports = function shallowEqual(objA, objB, compare, compareContext) {\n  var ret = compare ? compare.call(compareContext, objA, objB) : void 0;\n\n  if (ret !== void 0) {\n    return !!ret;\n  }\n\n  if (objA === objB) {\n    return true;\n  }\n\n  if (typeof objA !== \"object\" || !objA || typeof objB !== \"object\" || !objB) {\n    return false;\n  }\n\n  var keysA = Object.keys(objA);\n  var keysB = Object.keys(objB);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n\n  var bHasOwnProperty = Object.prototype.hasOwnProperty.bind(objB);\n\n  // Test for A's keys different from B.\n  for (var idx = 0; idx < keysA.length; idx++) {\n    var key = keysA[idx];\n\n    if (!bHasOwnProperty(key)) {\n      return false;\n    }\n\n    var valueA = objA[key];\n    var valueB = objB[key];\n\n    ret = compare ? compare.call(compareContext, valueA, valueB, key) : void 0;\n\n    if (ret === false || (ret === void 0 && valueA !== valueB)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n","import { createContext } from 'react'\n\nconst StoreContext = createContext()\n\nexport default StoreContext\n","import { useState, useEffect, useContext, useRef } from 'react'\nimport shallowEqual from 'shallowequal'\nimport EasyPeasyContext from './context'\nimport { isStateObject } from './lib'\n\nexport function useStore(mapState, dependencies = []) {\n  const store = useContext(EasyPeasyContext)\n  const [state, setState] = useState(mapState(store.getState()))\n  // As our effect only fires on mount and unmount it won't have the state\n  // changes visible to it, therefore we use a mutable ref to track this.\n  const stateRef = useRef(state)\n  // Helps avoid firing of events when unsubscribed, i.e. unmounted\n  const isActive = useRef(true)\n  useEffect(() => {\n    const calculateState = () => {\n      const newState = mapState(store.getState())\n      isActive.current = true\n      if (\n        newState === stateRef.current ||\n        (isStateObject(newState) &&\n          isStateObject(stateRef.current) &&\n          shallowEqual(newState, stateRef.current))\n      ) {\n        // Do nothing\n        return\n      }\n      stateRef.current = newState\n      // The settimeout wrap fixes a strange issue where a setState would\n      // fire but the associated hook wouldn't receive it. It's almost as\n      // if the effect was handled in a synchronous manner in some part of\n      // the React reconciliation process that ended up with it not\n      // propagating\n      setTimeout(() => {\n        if (isActive.current) {\n          setState(newState)\n        }\n      })\n    }\n    calculateState()\n    const unsubscribe = store.subscribe(calculateState)\n    return () => {\n      unsubscribe()\n      isActive.current = false\n    }\n  }, dependencies)\n  return state\n}\nexport function useAction(mapActions) {\n  const store = useContext(EasyPeasyContext)\n  return mapActions(store.dispatch)\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport StoreContext from './context'\n\nconst StoreProvider = ({ children, store }) => (\n  <StoreContext.Provider value={store}>{children}</StoreContext.Provider>\n)\n\nStoreProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n  store: PropTypes.object.isRequired,\n}\n\nexport default StoreProvider\n"],"names":["isStateObject","x","Array","isArray","effectSymbol","selectSymbol","selectDependenciesSymbol","selectStateSymbol","reducerSymbol","get","path","target","reduce","acc","cur","undefined","set","value","idx","length","tick","Promise","resolve","setTimeout","startsWith","search","substr","effect","fn","select","dependencies","selector","memoizeOne","state","reducer","createStore","model","options","devTools","middleware","initialState","injections","compose","reducerEnhancer","rootReducer","definition","logFullState","console","log","JSON","stringify","references","defaultState","actionEffects","actionCreators","actionReducers","customReducers","selectorReducers","extract","current","parentPath","Object","keys","forEach","key","executed","push","actionName","join","action","payload","dispatch","type","getState","parent","then","produce","draft","dispatchLocal","initialParentRef","createReducers","createActionsReducer","actionReducersAtPath","stateAtPath","nestedReducers","map","actionReducer","find","i","red","newState","reducerForActions","reducerWithCustom","stateAfterActions","p","runSelectorReducer","stateAfterDependencies","newValue","updateTarget","runSelectors","isInitial","stateAfterSelectors","reducers","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","reduxCompose","store","reduxCreateStore","applyMiddleware","thunk","StoreContext","createContext","useStore","mapState","useContext","EasyPeasyContext","useState","setState","stateRef","useRef","isActive","useEffect","calculateState","shallowEqual","unsubscribe","subscribe","useAction","mapActions","StoreProvider","children","React"],"mappings":"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"}